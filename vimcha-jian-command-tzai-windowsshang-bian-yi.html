<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>vim插件command-t在windows上编译</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Pacman News Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Pacman News </a></h1>
                <nav><ul>
                    <li><a href="/category/linux.html">Linux</a></li>
                    <li><a href="/category/python.html">python</a></li>
                    <li class="active"><a href="/category/vim.html">Vim</a></li>
                    <li><a href="/category/windows.html">Windows</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/vimcha-jian-command-tzai-windowsshang-bian-yi.html" rel="bookmark"
           title="Permalink to vim插件command-t在windows上编译">vim插件command-t在windows上编译</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-10-24T10:20:00+08:00">
                Published: Tue 24 October 2017
        </abbr>
		<br />
        <abbr class="modified" title="2017-10-24T19:30:00+08:00">
                Updated: Tue 24 October 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/r341h.html">r341h</a>
        </address>
<p>In <a href="/category/vim.html">Vim</a>.</p>
<p>tags: <a href="/tag/windows.html">windows</a> <a href="/tag/vim.html">vim</a> </p>
</footer><!-- /.post-info -->      <p>用Bundle在Windows平台上配置成功了以后，绝大多数插件都已经可以使用，但是唯独<a href="https://github.com/wincent/Command-T">Command-T</a>因为是Ruby集成的插件，需要手动编译。</p>
<p><a href="https://github.com/wincent/command-t/blob/master/doc/command-t.txt">官方文档</a>写的安装编译过程代码大概是这样的，我省去了使用bundle的安装过程：</p>
<div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/vim<span class="se">\b</span>undle<span class="se">\c</span>ommand-t<span class="se">\r</span>uby<span class="se">\c</span>ommand-t<span class="se">\e</span>xt<span class="se">\c</span>ommand-t&gt;
$ ruby extconf.rb
$ make
</pre></div>


<p>要完成这些肯定得装ruby和make，网上的绝大多数答案也都已经过期，说的是vim7.4左右的版本，而现在已经是vim 8.0。于是只好自己探索。</p>
<p>windows的ruby是一个特殊的安装包，和Ruby的官网都分开，网址是<a href="https://rubyinstaller.org/">RubyInstaller for windows</a>。</p>
<p>可供下载的版本从2.0.0-p648到2.4.2-2版本。</p>
<p>我从高版本开始尝试，安装2.4.2-2，安装成功并设置好windows环境变量，开始编译。结果发现报错 <code>You have to install development tools first.</code>. 于是我在官网发现了<code>DEVELOPMENT KIT</code>可以下载，但是居然只支持（Ruby 2.0 到 2.3），只好重新安装了Ruby 2.3, 并且按照官网development tools。</p>
<p>假设Ruby 安装到 C:\Ruby22-x64， 配置PATH环境变量。然后将Development tools 就解压到 C:\Ruby22-x64\DevKit, 然后进入该目录执行</p>
<div class="highlight"><pre><span></span>$ ruby dk.rb init
</pre></div>


<p>成功后再执行</p>
<div class="highlight"><pre><span></span>$ ruby dk.rb install
</pre></div>


<p>接着进入<code>~/vim\bundle\command-t\ruby\command-t\ext\command-t&gt;</code>文件夹，执行<code>ruby extconf.rb</code>命令，发现ruby执行成功了，用choco安装make并执行make一切都顺利。
但是进入vim一按command-t的快捷键报错，报错内容是：</p>
<div class="highlight"><pre><span></span>command-t.vim could not load the C extension
Please see INSTALLATION and TROUBLE-SHOOTING in the help
Vim Ruby version: 2.2.6
Expected version: 2.3.3
</pre></div>


<p>也就是vim内置的ruby版本和这个版本不匹配，看来我确实遗漏了vim内置版本的问题。于是继续降级到Ruby 2.2, 结果居然还是报错。报错内容依旧是<code>You have to install development tools first.</code> 然而我明明已经安装了development tools. </p>
<p>求助google，结果在<a href="https://github.com/OneClick/RubyInstaller/wiki/Development-Kit">RubyInstaller wiki</a>
有一段话是：</p>
<blockquote>
<p>The Hacky Developer Scenario – a developer building native gems wants to be able to quickly test that their extconf.rb file used to create a Makefile for the native library works correctly. To shorten the development cycle, the DevKit enables the developer to run <code>ruby -rdevkit extconf.rb</code>.</p>
</blockquote>
<p>于是我尝试带<code>-rdevkit</code>参数执行extconf.rb，结果果然通过了，但是make命令却无法通过。继续搜索，发现[AskUbuntu]上有个command-t的问题，没有用官方文档的方法编译command-t而是用了<code>rake make</code>来编译，我知道rake是ruby的一个工具，在jekyll尝试搭博客的时候用到，但不知道原理。但是反正是编译只要过了就行，于是我就尝试执行<code>rake make</code>结果还是不信，报错<code>You have to install development tools first.</code>，但是这样我没有理由不去尝试帮<code>rake make</code> 带上<code>-rdevkit</code>这样一个参数，结果居然真的成功了。</p>
<p>于是迫不及待打开vim，按下command-t的快捷键，一个漂亮的弹窗弹了出来。试着敲了几行，好像没有什么问题，大功告成。</p>
<p><img alt="command-t on windows" src="{{ &quot;/assets/images/commandt1.png&quot; | absolute_url }}"></p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://github.com/gccpacman">我的Github</a></li>
                            <li><a href="https://stackoverflow.com/users/4124310/realhu">我的StackOverflow</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>